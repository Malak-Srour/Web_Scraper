{% extends "base.html" %}

{% block title %}
    Articles by Keyword
{% endblock %}

{% block styles %}
    <style>
        #chartdiv {
            width: 100%;
            height: 300px;
        }

        /* Styling for the form */
        #keywordForm {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        /* Styling for the label */
        label[for="keyword"] {
            font-size: 18px;
            font-weight: bold;
            color: #333; /* Dark text color */
            margin-right: 10px;
            display: inline-block;
            transition: color 0.3s ease;
        }

        label[for="keyword"]:hover {
            color: #4CAF50; /* Change color to match the button when hovered */
        }

        /* Styling for the input field */
        #keyword {
            width: 250px;
            padding: 10px;
            border: 2px solid #4CAF50; /* Green border */
            border-radius: 5px;
            font-size: 16px;
            margin-right: 10px;
            background-color: #f0f0f0;
            color: #333;
            transition: all 0.3s ease;
        }

        #keyword:focus {
            outline: none;
            border-color: #45a049;
            box-shadow: 0px 0px 8px #45a049;
        }

        /* Styling for the submit button */
        button[type="submit"] {
            padding: 10px 20px;
            background-color: #4CAF50; /* Green background */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }

        button[type="submit"]:hover {
            background-color: #45a049; /* Darker green on hover */
            transform: scale(1.05);
        }

        button[type="submit"]:active {
            transform: scale(1);
        }
    </style>
{% endblock %}

{% block controls %}
    <form id="keywordForm">
        <label for="keyword">Enter Keyword:</label>
        <input type="text" id="keyword" name="keyword" required>
        <button type="submit">Search</button>
    </form>
{% endblock %}

{% block scripts %}
    <script>
        document.getElementById("keywordForm").addEventListener("submit", function(e) {
            e.preventDefault(); // Prevent form from refreshing the page
            const keyword = document.getElementById("keyword").value;

            if (keyword) {
                // Fetch data from the Flask API with the entered keyword
                fetch(`/articles_by_keyword/${keyword}`)
                    .then(response => response.json())
                    .then(data => {
                        renderChart(data);
                    })
                    .catch(error => console.error("Error fetching data:", error));
            }
        });

        function renderChart(data) {
            am5.ready(function() {

                // Create root element
                var root = am5.Root.new("chartdiv");

                // Set themes
                root.setThemes([am5themes_Animated.new(root)]);

                // Create container for chart
                var container = root.container.children.push(am5.Container.new(root, {
                    width: am5.percent(100),
                    height: am5.percent(100),
                    layout: root.verticalLayout
                }));

                // Create series (Force Directed Tree)
                var series = container.children.push(am5hierarchy.ForceDirected.new(root, {
                    valueField: "value",
                    categoryField: "name",
                    childDataField: "children",
                    idField: "name",
                    minRadius: 50,  // Minimum size of the circles
                    maxRadius: 100,  // Maximum size of the circles
                    manyBodyStrength: -10,
                    centerStrength: 0.8
                }));

                series.data.setAll([data]); // Set the dynamic data

                series.set("selectedDataItem", series.dataItems[0]);

                // Make the chart animate
                series.appear(1000, 100);

            }); // end am5.ready()
        }
    </script>
{% endblock %}
